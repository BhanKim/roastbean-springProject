<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rb.base.dao.BoardDao">
		
		<!-- Paging count -->
		<select id="boardlistrow" resultType="Integer">
			SELECT count(*) as total from community where community_deletedate is null and community_name != 'admin'
		</select>
		
		<!-- all select -->
		<select id="boardList" resultType="com.rb.base.model.BoardDto">
			<!-- SELECT * FROM community where community_deletedate is null -->
			SELECT * FROM (SELECT row_number() over(order by community_group, community_indent desc)
  		    as rownum, community_id, u.user_nick, community_title, community_content, 
    		community_initdate, community_updatedate, community_deletedate, community_hit,
       		community_group, community_step, community_indent, community_cnt
     		FROM community as c, `user` as u  where community_deletedate is null and u.user_id != 'admin'
      		and u.user_id = c.community_name order by community_group desc, community_indent)A 
      		where <![CDATA[rownum <= #{rowCount}]]> and <![CDATA[rownum >= #{start}]]>;
		</select>
		
		<!-- content view -->
		<select id="contentView" resultType="com.rb.base.model.BoardDto">
			SELECT * FROM community as c, `user` as u where c.community_name = u.user_id and community_id = #{community_id}
		</select>
		
		<!-- Write -->
		<insert id="boardwrite">
			insert into community (community_name, community_title, community_content, community_hit, community_group, community_step, community_indent, community_cnt, community_initdate)
    		values(#{community_name}, #{community_title}, #{community_content}, 0, (select * from(select max(community_id)+1 from community)a) ,0, 0, 0, now())
		</insert>
		
		<!-- Delete -->
		<update id="communitydelete">
			UPDATE community SET community_deletedate = now() where community_id = #{community_id}
		</update>
		
		<!-- Update view -->
		<select id="modify_view" resultType="com.rb.base.model.BoardDto">
			SELECT * FROM community where community_id = #{community_id}
		</select>
		
		<!-- Update -->
		<update id="modify">
			UPDATE community SET community_title = #{community_title}, community_content = #{community_content}, community_updatedate = now() where community_id = #{community_id}
		</update>
		
		<!-- 조회수 -->
		<update id="upHit">
			update community set community_hit = community_hit + 1 where community_id = #{community_id}
		</update>
		
		<!-- 좋아요 -->
		<update id="like">
			update community set community_cnt = community_cnt + 1 where community_id = #{community_id}
		</update>
	
</mapper>